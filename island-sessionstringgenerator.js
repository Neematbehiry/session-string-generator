import{c as te,d as q}from"./chunk-2FIABPOA.js";import{d as K,e as Q,f as X,g as Z}from"./chunk-SJZ7276F.js";import{a as j,c as E,e as H,g as z,h as ee}from"./chunk-NNAG4XTC.js";import{a as p}from"./chunk-6BZOKKMB.js";import{b as Y}from"./chunk-LT2JLGES.js";import{a as re}from"./chunk-LKXCJMUL.js";import{b as l,c as v,d as N,e as S}from"./chunk-ZCIEHKIL.js";import{a as c}from"./chunk-77B6PULZ.js";import{b as f}from"./chunk-B3RIN4KF.js";import"./chunk-LLXL7IGU.js";import{b as J}from"./chunk-LD6EYMCV.js";import{a as i}from"./chunk-YTKEQ3B2.js";import{b as _}from"./chunk-GUU3JZUY.js";import"./chunk-LYNC7AOZ.js";import{a as O,b as k}from"./chunk-6DAESB25.js";import{a as e}from"./chunk-TSWBBZEI.js";import{b as F}from"./chunk-OAXRZPAS.js";import{d as g,e as U}from"./chunk-E3MB5WL4.js";import{e as d}from"./chunk-WOE4W6CR.js";import"./chunk-Z47A3HLT.js";var T=class extends re{strings;constructor(){super("session-string-generator"),this.version(2).stores({strings:"&account"})}};var ae=new T,oe=O(),x=()=>{let a=oe.value.toLowerCase().slice(1).split(",");return a.length>3?[]:a},se=a=>{let r=x().filter(t=>t!="test");a=="Test"&&r.push("test"),k(r.sort((t,n)=>t.localeCompare(n)).join(","))},ie=a=>{let r=x().filter(t=>t!="user");a=="User"&&r.push("user"),k(r.sort((t,n)=>t.localeCompare(n)).join(","))},s=g(""),V=g(!1),G=_("","string-session-generator_apiId"),R=_("","string-session-generator_apiHash"),W=U(()=>{let a=x();return a.length==1?"Production":a.includes("test")?"Test":"Production"}),B=U(()=>{let a=x();return a.length==1?"Bot":a.includes("user")?"User":"Bot"}),w=g(""),le=[{name:"Telethon",link:"telethon.dev"},{name:"Pyrogram",link:"pyrogram.org"},{name:"GramJS",link:"gram.js.org"},{name:"mtcute",link:"mtcute.dev"},{name:"MTKruto",link:"mtkru.to"}];async function ue(a){let r=async()=>{V.value=!0;try{v(),await de(a).finally(()=>{})}finally{V.value=!1}},t=await ae.strings.get({account:w.value});if(t&&"string"in t){l(e(d,{children:[e("p",{children:"A session string was recently generated for this account. Do you want to see that one?"}),e(i,{onClick:()=>{pe(t.string,a),v()},children:"Yes"}),e(i,{muted:!0,onClick:r,children:"No, regenerate"})]}),void 0,!1);return}await r()}function ze(){if(!F)return null;let r=x()[0];return te(r)?V.value?e(d,{children:[e("div",{class:"gap-1.5 text-xs opacity-50 flex w-full items-center justify-center max-w-lg mx-auto",children:[e(J,{size:10})," ",e("span",{children:"Generating session string"})]}),e(S,{})]}):s.value?e(d,{children:[e("div",{class:"gap-4 flex flex-col w-full max-w-lg mx-auto",children:[e("div",{children:e("button",{class:"text-grammy",onClick:()=>s.value="",children:"\u2190 Back"})}),e("div",{class:"bg-border rounded-xl p-3 text-sm font-mono break-all select-text",children:s.value}),e(i,{onClick:()=>{navigator.clipboard.writeText(s.value).then(()=>{l("Copied to clipboard.")})},children:"Copy"})]}),e(S,{})]}):e(d,{children:[e("form",{class:"gap-4 flex flex-col w-full max-w-lg mx-auto",onSubmit:t=>{t.preventDefault(),ue(r).catch(n=>{n instanceof X.TelegramError?N(n.errorMessage):N(n)})},children:[e(p,{children:[e(c,{children:"Environment"}),e(q,{value:W.value,values:["Production","Test"],onChange:t=>se(t)})]}),e(p,{children:[e(c,{children:"App Credentials"}),e(f,{placeholder:"API ID",name:"token",required:!0,value:G.value,onChange:t=>G.value=t.currentTarget.value}),e(f,{placeholder:"API hash",name:"token",required:!0,value:R.value,onChange:t=>R.value=t.currentTarget.value})]}),e(p,{children:[e(c,{children:"Account Type"}),e(q,{values:["Bot","User"],value:B.value,onChange:t=>ie(t)})]}),e(p,{children:[e(c,{children:"Account Details"}),e(f,{placeholder:B.value=="Bot"?"Bot token":"Phone number in international format",value:w.value,required:!0,onChange:t=>w.value=t.currentTarget.value})]}),e(p,{children:[e(i,{children:"Next"}),e(c,{children:"The credentials you enter are used only in connections made directly to Telegram."})]})]}),e(S,{})]}):e(ce,{})}function ce(){return e("div",{class:"gap-4 flex flex-col w-full max-w-sm mx-auto",children:[e("div",{class:"text-xl font-bold",children:"Which library do you use?"}),le.map(a=>e("button",{class:"bg-gradient py-3 px-4 rounded-xl border-border border-2 cursor-pointer flex flex-col items-start justify-center",onClick:r=>r.currentTarget==r.target&&k(a.name.toLowerCase()),children:[e("span",{class:"text-lg pointer-events-none",children:a.name}),e("span",{class:"opacity-50 text-xs",children:a.link})]}))]})}async function pe({apiId:a,dcId:r,ip:t,testMode:n,me:o,authKey:u},b){switch(b){case"telethon":s.value=j(r,t,80,u);break;case"pyrogram":{s.value=H(r,a,n,u,o.id,o.isBot);break}case"gramjs":s.value=E(r,t,80,u);break;case"mtcute":{s.value=z(n,{id:r,ip:t,port:80},null,o.id,o.isBot,u);break}case"mtkruto":s.value=await ee(`${r}${n?"-test":""}`,u);break;default:l("The chosen library is currently not supported.");return}}async function de(a){let r=Number(G.value),t=R.value,n=w.value;if(isNaN(r)||!r||!t){l("Invalid API credentials.");return}if(!n){l("Invalid account details.");return}if(B.value!="Bot"&&!w.value.startsWith("+")){l("The phone number must start with a plus sign.");return}let o=new Z({storage:new K,apiId:r,apiHash:t,deviceModel:navigator.userAgent.trim().split(" ")[0]||"Unknown",initialDc:W.value=="Test"?"2-test":void 0}),u=!0,b=g(!0),$=!0,P=g(!0);await o.start(B.value=="Bot"?{botToken:n}:{phone:n,code:()=>new Promise((I,D)=>{!u&&b.value&&(b.value=!1),l(()=>e(me,{first:b,resolve:M=>{I(M)},cancel:()=>{v(),D()}}),!1,!1),u=!1}),password:I=>new Promise((D,M)=>{!$&&P.value&&(P.value=!1),l(()=>e(ge,{hint:I,first:P,resolve:ne=>{D(ne)},cancel:()=>{v(),M()}}),!1,!1),$=!1})}),v();let A=await o.storage.getDc(),m=await o.storage.getAuthKey();(!A||!m)&&Y();let C=Q(A,"ipv4")[0],h=Number(A.split("-")[0]),L=W.value=="Test",y=await o.getMe();switch(a){case"telethon":s.value=j(h,C,80,m);break;case"pyrogram":{s.value=H(h,r,L,m,y.id,y.isBot);break}case"gramjs":s.value=E(h,C,80,m);break;case"mtcute":{s.value=z(L,{id:h,ip:C,port:80},null,y.id,y.isBot,m);break}case"mtkruto":s.value=await o.exportAuthString();break;default:l("The chosen library is currently not supported.");return}await ae.strings.put({account:n,string:{apiId:r,ip:C,dcId:h,testMode:L,me:y,authKey:m}}),await o.disconnect()}function me({first:a,resolve:r,cancel:t}){return a.value?e("form",{class:"flex flex-col gap-4",onSubmit:n=>{n.preventDefault(),r(new FormData(n.currentTarget).get("code"))},children:[e(p,{children:[e(f,{name:"code",placeholder:"Code",pattern:"^[0-9]{4,}$",required:!0}),e(c,{children:"Enter the code you received."})]}),e(i,{children:"Next"}),e(i,{type:"button",danger:!0,onClick:t,children:"Cancel"})]}):e(d,{children:[e("div",{children:"Invalid code."}),e(i,{onClick:()=>a.value=!0,children:"Retry"}),e(i,{type:"button",danger:!0,onClick:t,children:"Cancel"})]})}function ge({hint:a,first:r,resolve:t,cancel:n}){return r.value?e("form",{class:"flex flex-col gap-4",onSubmit:o=>{o.preventDefault(),t(new FormData(o.currentTarget).get("password"))},children:[e(p,{children:[e(f,{type:"password",name:"password",placeholder:a||"Password",pattern:".+",required:!0}),e(c,{children:"Enter your account\u2019s password."})]}),e(i,{children:"Next"}),e(i,{type:"button",danger:!0,onClick:n,children:"Cancel"})]}):e(d,{children:[e("div",{children:"Invalid code."}),e(i,{onClick:()=>r.value=!0,children:"Retry"}),e(i,{danger:!0,onClick:n,children:"Cancel"})]})}export{ze as SessionStringGenerator};
